bt_navigator:
  ros__parameters:
    use_sim_time: False
    global_frame: map
    robot_base_frame: base_footprint
    odom_topic: /odom
    bt_loop_duration: 10
    default_server_timeout: 20
    plugin_lib_names:
    - nav2_compute_path_to_pose_action_bt_node
    - nav2_compute_path_through_poses_action_bt_node
    - nav2_follow_path_action_bt_node
    - nav2_back_up_action_bt_node
    - nav2_spin_action_bt_node
    - nav2_wait_action_bt_node
    - nav2_clear_costmap_service_bt_node
    - nav2_is_stuck_condition_bt_node
    - nav2_goal_reached_condition_bt_node
    - nav2_goal_updated_condition_bt_node
    - nav2_initial_pose_received_condition_bt_node
    - nav2_reinitialize_global_localization_service_bt_node
    - nav2_rate_controller_bt_node
    - nav2_distance_controller_bt_node
    - nav2_speed_controller_bt_node
    - nav2_truncate_path_action_bt_node
    - nav2_goal_updater_node_bt_node
    - nav2_recovery_node_bt_node
    - nav2_pipeline_sequence_bt_node
    - nav2_round_robin_node_bt_node
    - nav2_transform_available_condition_bt_node
    - nav2_time_expired_condition_bt_node
    - nav2_distance_traveled_condition_bt_node
    - nav2_single_trigger_bt_node
    - nav2_is_battery_low_condition_bt_node
    - nav2_navigate_through_poses_action_bt_node
    - nav2_navigate_to_pose_action_bt_node
    - nav2_remove_passed_goals_action_bt_node

bt_navigator_rclcpp_node:
  ros__parameters:
    use_sim_time: False

controller_server:
  ros__parameters:
    use_sim_time: False
    controller_frequency: 20.0
    min_x_velocity_threshold: 0.001
    min_y_velocity_threshold: 0.5
    min_theta_velocity_threshold: 0.001
    failure_tolerance: 0.3
    odom_topic: "/odom"
    progress_checker_plugin: "progress_checker"
    goal_checker_plugins: ["goal_checker"]
    controller_plugins: ["FollowPath"]
    progress_checker:
      plugin: "nav2_controller::SimpleProgressChecker"
      required_movement_radius: 0.5
      movement_time_allowance: 10.0
    goal_checker:
      plugin: "nav2_controller::SimpleGoalChecker"
      xy_goal_tolerance: 0.05 #2.5 #0.15
      yaw_goal_tolerance: 0.05 #2.5 #0.15
      stateful: True
    # Regulated Pure Pursuit Controller parameters
    # FollowPath:
    #   plugin: "nav2_regulated_pure_pursuit_controller::RegulatedPurePursuitController"
    #   desired_linear_vel: 0.3
    #   lookahead_dist: 0.6
    #   min_lookahead_dist: 0.3
    #   max_lookahead_dist: 0.9
    #   lookahead_time: 1.5
    #   rotate_to_heading_angular_vel: 1.8
    #   transform_tolerance: 0.25
    #   use_velocity_scaled_lookahead_dist: false
    #   min_approach_linear_velocity: 0.05
    #   approach_velocity_scaling_dist: 0.6
    #   use_collision_detection: true
    #   max_allowed_time_to_collision_up_to_carrot: 1.0
    #   use_regulated_linear_velocity_scaling: true
    #   use_fixed_curvature_lookahead: false
    #   curvature_lookahead_dist: 0.25
    #   trans_stopped_velocity: 0.50
    #   use_cost_regulated_linear_velocity_scaling: false
    #   regulated_linear_scaling_min_radius: 0.9
    #   regulated_linear_scaling_min_speed: 0.25
    #   use_rotate_to_heading: true
    #   allow_reversing: false
    #   rotate_to_heading_min_angle: 0.785
    #   max_angular_accel: 3.2
    #   max_robot_pose_search_dist: 10.0
    #   use_interpolation: true
    # DWB Controller parameters
    FollowPath:
      plugin: "dwb_core::DWBLocalPlanner"
      debug_trajectory_details: True
      min_vel_x: -0.1 # 0.0 - Default
      min_vel_y: 0.0
      max_vel_x: 0.26     # 0.3 # 0.26 - Default
      max_vel_y: 0.0
      max_vel_theta: 0.4  # 1.0 - Default
      min_speed_xy: 0.0
      max_speed_xy: 0.5  # 0.3 # 0.26 - Default
      min_speed_theta: 0.0
      acc_lim_x: 2.5 
      acc_lim_y: 0.0
      acc_lim_theta: 3.2
      decel_lim_x: -2.5   # -2.5 - default
      decel_lim_y: 0.0
      decel_lim_theta: -3.2 # -3.2 - default
      vx_samples: 20
      vy_samples: 0
      vtheta_samples: 40
      sim_time: 1.7
      linear_granularity: 0.05
      angular_granularity: 0.025
      transform_tolerance: 0.2
      xy_goal_tolerance: 0.05 #0.15
      trans_stopped_velocity: 0.25 #0.25
      short_circuit_trajectory_evaluation: True
      stateful: True
      critics: ["RotateToGoal", "Oscillation", "ObstacleFootprintCritic", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]
      #["RotateToGoal", "Oscillation", "ObstacleFootprintCritic", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist","PreferForwardCritic"]
      BaseObstacle.scale: 1.0 #1.0
      PathAlign.scale: 32.0
      PathAlign.forward_point_distance: 0.325
      GoalAlign.scale: 24.0
      GoalAlign.forward_point_distance: 0.325
      PathDist.scale: 32.0
      GoalDist.scale: 24.0
      RotateToGoal.scale: 32.0
      RotateToGoal.slowing_factor: 5.0

    

controller_server_rclcpp_node:
  ros__parameters:
    use_sim_time: False

local_costmap:
  local_costmap:
    ros__parameters:
      footprint_padding: 0.0
      update_frequency: 5.0
      publish_frequency: 2.0
      global_frame: odom
      robot_base_frame: base_footprint # base_footprint # base_link - default
      use_sim_time: False
      rolling_window: True
      width: 5
      height: 5
      resolution: 0.05
      footprint: "[[-0.352865,0.55675], [1.052865,0.55675], [1.052865,-0.55675], [-0.352865,-0.55675]]"
      plugins: ["obstacle_layer", "voxel_layer", "inflation_layer"] # , "social_layer", "virtual_wall_layer"
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan virtual_wall_cloud
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
        virtual_wall_cloud:
          topic: /virtual_wall_cloud
          max_obstacle_height: 100000.0
          marking: True
          clearing: True
          data_type: "PointCloud2"
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: True
        publish_voxel_map: False
        origin_z: 0.0
        z_resolution: 0.05
        z_voxels: 16
        max_obstacle_height: 2.0
        mark_threshold: 0
        observation_sources: scan virtual_wall_cloud
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 6.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
        virtual_wall_cloud:
          topic: /virtual_wall_cloud
          max_obstacle_height: 100000.0
          marking: True
          clearing: True
          data_type: "PointCloud2"
          raytrace_max_range: 100000.0
          raytrace_min_range: 0.0
          obstacle_max_range: 100000.5
          obstacle_min_range: 0.0
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 6.58 #2.58
        inflation_radius: 0.2     # çarpma yarıçapı
      # virtual_wall_layer:
      #   plugin: "costmap_virtual_wall::VirtualWallLayer"
      #   enabled: True
      # social_layer:
      #   plugin: "nav2_social_costmap_plugin::SocialLayer"
      #   enabled: True
      #   cutoff: 10.0
      #   amplitude: 255.0
      #   publish_occgrid: True
      #   use_passing: True
      #   use_vel_factor: True
      #   speed_factor_multiplier: 5.0
      #   covariance_front_height: 0.4
      #   covariance_front_width: 0.25
      #   covariance_rear_height: 0.25
      #   covariance_rear_width: 0.25
      #   covariance_right_height: 0.3
      #   covariance_right_width: 0.2
      #   covariance_when_still: 0.25
      # always_send_full_costmap: True
  local_costmap_client:
    ros__parameters:
      use_sim_time: False
  local_costmap_rclcpp_node:
    ros__parameters:
      use_sim_time: False

global_costmap:
  global_costmap:
    ros__parameters:
      update_frequency: 1.0
      publish_frequency: 1.0
      global_frame: map
      robot_base_frame: base_footprint
      footprint: "[[-0.352865,0.55675], [1.052865,0.55675], [1.052865,-0.55675], [-0.352865,-0.55675]]"
      # robot_radius: 0.579
      use_sim_time: False
      resolution: 0.05 #Arttırılabilir.
      track_unknown_space: true
      plugins: ["static_layer", "obstacle_layer", "voxel_layer", "inflation_layer"] #, "virtual_wall_layer"
      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: True
        map_topic: /map
        enabled: true
        subscribe_to_updates: true
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        footprint_clearing_enabled: false
        observation_sources: scan virtual_wall_cloud
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 10.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
        virtual_wall_cloud:
          topic: /virtual_wall_cloud
          max_obstacle_height: 100000.0
          marking: True
          clearing: True
          data_type: "PointCloud2"
          raytrace_max_range: 100000.0
          raytrace_min_range: 0.0
          obstacle_max_range: 100000.5
          obstacle_min_range: 0.0
      voxel_layer:
        plugin: "nav2_costmap_2d::VoxelLayer"
        enabled: True
        publish_voxel_map: True
        origin_z: 0.0
        z_resolution: 0.05
        z_voxels: 16
        max_obstacle_height: 2.0
        mark_threshold: 0
        observation_sources: scan virtual_wall_cloud
        scan:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True
          marking: True
          data_type: "LaserScan"
          raytrace_max_range: 3.0
          raytrace_min_range: 0.0
          obstacle_max_range: 2.5
          obstacle_min_range: 0.0
        virtual_wall_cloud:
          topic: /virtual_wall_cloud
          max_obstacle_height: 100000.0
          marking: True
          clearing: True
          data_type: "PointCloud2"
          raytrace_max_range: 100000.0
          raytrace_min_range: 0.0
          obstacle_max_range: 100000.5
          obstacle_min_range: 0.0
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 6.58 #2.58
        inflation_radius: 0.45
      # virtual_wall_layer:
      #   plugin: "costmap_virtual_wall::VirtualWallLayer"
      #   enabled: True
      always_send_full_costmap: True

  global_costmap_client:
    ros__parameters:
      use_sim_time: False
  global_costmap_rclcpp_node:
    ros__parameters:
      use_sim_time: False

planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0
    use_sim_time: False
    planner_plugins: ["GridBased"]
    # NavFN Planner parameter
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 0.2
      use_astar: false
      allow_unknown: false
    # SmacPlanner2D parameter
    # GridBased:
    #   plugin: "nav2_smac_planner/SmacPlanner2D"
    #   tolerance: 0.25                      # tolerance for planning if unable to reach exact pose, in meters
    #   downsample_costmap: True             # whether or not to downsample the map
    #   downsampling_factor: 3                # multiplier for the resolution of the costmap layer (e.g. 2 on a 5cm costmap would be 10cm)
    #   allow_unknown: true                   # allow traveling in unknown space
    #   max_iterations: 1000000               # maximum total iterations to search for before failing (in case unreachable), set to -1 to disable
    #   max_on_approach_iterations: 1000      # maximum number of iterations to attempt to reach goal once in tolerance
    #   max_planning_time: 2.0                # max time in s for planner to plan, smooth
    #   cost_travel_multiplier: 2.0           # Cost multiplier to apply to search to steer away from high cost areas. Larger values will place in the center of aisles more exactly (if non-`FREE` cost potential field exists) but take slightly longer to compute. To optimize for speed, a value of 1.0 is reasonable. A reasonable tradeoff value is 2.0. A value of 0.0 effective disables steering away from obstacles and acts like a naive binary search A*.
    #   use_final_approach_orientation: False # Whether to set the final path pose at the goal's orientation to the requested orientation (false) or in line with the approach angle so the robot doesn't rotate to heading (true)
    #   smoother:
    #     max_iterations: 1000
    #     w_smooth: 0.3
    #     w_data: 0.2
    #     tolerance: 1e-10

planner_server_rclcpp_node:
  ros__parameters:
    use_sim_time: False

smoother_server:
  ros__parameters:
    use_sim_time: True
    smoother_plugins: ["simple_smoother"]
    simple_smoother:
      plugin: "nav2_smoother::SimpleSmoother"
      tolerance: 1.0e-10
      max_its: 1000
      do_refinement: True

# recoveries_server:
#   ros__parameters:
#     costmap_topic: local_costmap/costmap_raw
#     footprint_topic: local_costmap/published_footprint
#     cycle_frequency: 10.0
#     recovery_plugins: ["spin", "backup", "wait"]
#     spin:
#       plugin: "nav2_recoveries/Spin"
#     backup:
#       plugin: "nav2_recoveries/BackUp"
#     wait:
#       plugin: "nav2_recoveries/Wait"
#     global_frame: odom
#     robot_base_frame: base_footprint
#     transform_timeout: 0.1
#     use_sim_time: False
#     simulate_ahead_time: 2.0
#     max_rotational_vel: 1.0
#     min_rotational_vel: 0.4
#     rotational_acc_lim: 3.2

robot_state_publisher:
  ros__parameters:
    use_sim_time: False

waypoint_follower:
  ros__parameters:
    loop_rate: 20
    stop_on_failure: false
    waypoint_task_executor_plugin: "wait_at_waypoint"   
    wait_at_waypoint:
      plugin: "nav2_waypoint_follower::WaitAtWaypoint"
      enabled: True
      waypoint_pause_duration: 0

# velocity_smoother:
#   ros__parameters:
#     smoothing_frequency: 20.0
#     scale_velocities: false
#     feedback: "OPEN_LOOP"
#     max_velocity: [0.2, 0.0, 0.5]
#     min_velocity: [-0.2, 0.0, -0.5]
#     deadband_velocity: [0.0, 0.0, 0.0]
#     velocity_timeout: 1.0
#     max_accel: [2.5, 0.0, 3.2]
#     max_decel: [-2.5, 0.0, -3.2]
#     odom_topic: "/diffamr_diff_drive_controller/odom"
#     odom_duration: 0.1
#     use_realtime_priority: false
#     enable_stamped_cmd_vel: false